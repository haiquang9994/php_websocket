"use strict";function _instanceof(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):t instanceof n}function _classCallCheck(t,n){if(!_instanceof(t,n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),t}function _slicedToArray(t,n){return _arrayWithHoles(t)||_iterableToArrayLimit(t,n)||_unsupportedIterableToArray(t,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,n){if(t){if("string"==typeof t)return _arrayLikeToArray(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,n):void 0}}function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function _iterableToArrayLimit(t,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(e.push(i.value),!n||e.length!==n);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return e}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(){var t={websockets:{},ws_run:function(n,e){var r=this,o=new WebSocket(e),a=null;try{(a=this.ws_find(n)).socket=o}catch(t){a={events:[],stacks:[],socket:o,meta:{count:0,callbacks:{}}}}this.websockets[n]=a,o.onopen=function(t){for(var e=r.ws_find(n).stacks,a=e.shift();a;)o.send(a),a=e.shift()},o.onmessage=function(e){var a=JSON.parse(e.data),i=t.ws_find(n).meta;if(3===a.length){var s=_slicedToArray(a,3),c=(s[0],s[1]),u=s[2];(r.websockets[n].events[c]||[]).forEach(function(t){"function"==typeof t&&t.call(o,u)})}else{var l=_slicedToArray(a,2),f=l[0],h=l[1],y=i.callbacks,_=y[f];delete y[f],"function"==typeof _&&_.call(null,h)}},o.onclose=function(){setTimeout(function(){r.ws_run(n,e)},1e3)}},ws_push_event:function(t,n,e){var r=this.ws_find(t).events;r[n]||(r[n]=[]),r[n].push(e)},ws_push_stack:function(t,n){this.ws_find(t).stacks.push(n)},ws_find:function(t){var n=this.websockets[t];if(!n)throw"Socket not found!";return n},ws_url:function(t,n){var e={},r=t.split("#")[0].split("?"),o=r[0].replace("http","ws");(r[1]||"").split("&").map(function(t){return t.split("=")}).filter(function(t){return 2===t.length}).forEach(function(t){e[t[0]]=t[1]}),e.sid=n;var a=[];for(var i in e){var s=e[i];a.push("".concat(i,"=").concat(s))}return o+"?"+a.join("&")},ws_emit:function(n,e,r,o){var a=t.ws_find(n),i=a.socket,s=a.meta,c=JSON.stringify([s.count,e,r]);s.callbacks[s.count++]=o,i&&1===i.readyState?i.send(c):t.ws_push_stack(n,c)}},n=function(){function n(e){_classCallCheck(this,n),this.id=Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),t.ws_run(this.id,t.ws_url(e,this.id))}return _createClass(n,[{key:"on",value:function(n,e){t.ws_push_event(this.id,n,e)}},{key:"emit",value:function(n,e,r){t.ws_emit(this.id,n,e,r)}}]),n}();window.WSClient=n}();